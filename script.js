// script.js (完全版)

// 1. データの定義
// =================================

// 各MBTIタイプの特徴データ
const mbtiData = {
    "INFP": {
        alias: "仲介者",
        title: "INFP (仲介者型)",
        description: "詩人肌で、常に物事の善い面を探し求める真の理想主義者。自らの価値観と信念に忠実で、独自の視点から世界を眺めます。共感力が高く、他人の感情を深く理解しようと努めます。",
        detailed_description: "INFPは内向的(I)、直観的(N)、感情的(F)、知覚的(P)な特性を持ち、その心は常に情熱と創造性で満ちています。一見すると物静かで控えめに見えるかもしれませんが、内面には燃えるような炎を秘めています。自分の信じる理想のためなら、驚くほどのエネルギーを発揮します。完璧主義な一面もあり、自分の作品やアイデアに高い基準を設けるため、時に自己批判的になりすぎることもあります。",
        strengths: ["共感力と深い思いやり", "創造的で豊かな想像力", "強い価値観と理想主義", "他人の可能性を見出す力", "柔軟でオープンな思考"],
        weaknesses: ["過度に理想主義的で現実離れしがち", "自己批判が強く、自分を追い詰める", "対立を避けすぎる傾向", "データや論理よりも感情を優先しやすい", "物事を個人的に捉えやすい"],
        conversation: `（友人が仕事の愚痴をこぼしている）\n友人A: 「もう今の仕事、辞めたいかも…。毎日同じことの繰り返しで、何のためにやってるのか分からなくなってきた。」\nINFP: 「そっか…、すごく大変だったんだね。毎日頑張ってるのに、やりがいを感じられないのは辛いよね。でも、あなたが本当にやりたいことって何なんだろう？もし何の制約もなかったら、どんなことに挑戦してみたい？あなたの持っている優しさやアイデアは、きっともっと違う場所で輝くと思うんだ。話を聞くことしかできないけど、いつでもここにいるからね。」`
    },
    "ENFJ": {
        alias: "主人公",
        title: "ENFJ (主人公型)",
        description: "人々を励まし、世界に良い影響を与えることを使命とする、天性のリーダー。カリスマ性と情熱に溢れ、その言葉は多くの人々の心を動かします。他人の成長を心から願う、愛情深い指導者です。",
        detailed_description: "ENFJは外向的(E)、直観的(N)、感情的(F)、判断的(J)な特性を持ちます。彼らは人の感情や動機を敏感に察知し、自然と周りの人々を巻き込んでコミュニティを形成します。強い信念を持ち、それを実現するために計画を立てて行動に移す力があります。ただ、他人を助けたいという気持ちが強すぎるあまり、自分のニーズを後回しにしたり、他人の問題に過剰に介入してしまうこともあります。",
        strengths: ["カリスマ性があり、人々を惹きつける", "優れたコミュニケーション能力", "共感的で、他人の気持ちに寄り添える", "組織をまとめ、導くリーダーシップ", "信頼でき、責任感が強い"],
        weaknesses: ["時に過剰に理想主義的", "他人の問題を抱え込みすぎる", "批判に対して非常に敏感", "自分の意見を押し付けがちになることがある", "決断が感情に流されやすい"],
        conversation: `（チームミーティングにて）\nENFJ: 「みんな、今週もお疲れ様！次のプロジェクトの件だけど、いくつか素晴らしいアイデアが浮かんだんだ。Aさんの分析力と、Bさんのデザインセンスを組み合わせたら、絶対に最高のものができると思う。どうかな？みんなで力を合わせれば、クライアントの期待をはるかに超えるものが作れるはずだよ！何か意見や心配なことがあったら、何でも言ってほしい。一緒に乗り越えよう！」`
    },
    "ISTP": {
        alias: "巨匠",
        title: "ISTP (巨匠型)",
        description: "大胆かつ実践的な思考の持ち主で、あらゆるものを探求し、作り出すことを楽しみます。冷静な合理性と旺盛な好奇心で、手を使って物事の仕組みを解明し、問題を解決することに長けています。",
        detailed_description: "ISTPは内向的(I)、感覚的(S)、思考的(T)、知覚的(P)な特性を持ち、クールで独立心旺盛な一匹狼タイプです。理論よりも実践を重んじ、五感を通して世界を体験することを好みます。危機的状況でもパニックに陥ることなく、冷静に状況を分析し、最適な解決策を即座に見つけ出します。一方で、長期的な計画や抽象的な議論にはあまり興味を示さず、束縛されることを嫌うため、組織の中では少し浮いてしまうこともあります。",
        strengths: ["実践的な問題解決能力", "危機的状況での冷静さと対応力", "効率的でエネルギッシュ", "優れた観察眼と分析力", "好奇心旺盛で新しいスキルをすぐ習得する"],
        weaknesses: ["長期的な計画を立てるのが苦手", "感情表現が不得手で、鈍感に見えることがある", "ルールや束縛を嫌う", "時に衝動的でリスクを恐れない", "退屈しやすい"],
        conversation: `（友人のPCの調子が悪い）\n友人A: 「うわ、PCが固まった…どうしよう、大事なデータが入ってるのに！」\nISTP: 「ちょっと見せて。（キーボードをいくつか叩き、裏蓋を眺め）…変な音はしてないな。たぶんメモリの接触不良か、一時的な熱暴走じゃないか？強制終了して、少し放置してから再起動してみろよ。それでダメなら、中開けてみるから。あ、ドライバーどこだっけな。」`
    },
    "ESFP": {
        alias: "エンターテイナー",
        title: "ESFP (エンターテイナー型)",
        description: "自発的でエネルギッシュ、そして熱意にあふれる、まさに天性のエンターテイナー。彼らがいるだけで、その場が明るくなります。今この瞬間を最大限に楽しむことを愛し、その喜びを周りの人々と分かち合おうとします。",
        detailed_description: "ESFPは外向的(E)、感覚的(S)、感情的(F)、知覚的(P)な特性を持ちます。彼らの関心は常に「今、ここ」にあり、五感で感じられる具体的な世界を楽しみます。美的センスに優れ、ファッションやインテリア、食事などを通じて自己表現をします。人々の注目を浴びるのが好きで、サービス精神も旺盛。しかし、将来のことや退屈な義務からは目をそらしがちで、衝動的に行動してしまうことも少なくありません。",
        strengths: ["社交的で、誰とでもすぐに打ち解ける", "優れた美的感覚とセンス", "実践的で現実的なアプローチ", "場の空気を明るくするムードメーカー", "大胆で独創的"],
        weaknesses: ["対立や気まずい状況を極端に嫌う", "長期的な計画や将来設計が苦手", "退屈な作業に集中できない", "衝動的で、後先を考えずに行動しがち", "批判に傷つきやすい"],
        conversation: `（週末の予定を話している）\nESFP: 「ねえねえ、今週末どうする？駅前に新しいカフェができたんだけど、そこのケーキがすっごくインスタ映えするらしいよ！絶対行きたい！その後はショッピングして、夜はカラオケとかどう？あ、でもあそこの公園で野外ライブもやってるって聞いたな…。うーん、どうしよう、全部楽しそう！とりあえず、行ってみてから決めちゃおうよ！ねっ！」`
    }
    // ... 他の12タイプもこの形式で追加してください ...
};

// 2タイプ間の相性データ
const compatibilityData = {
    "ENFJ-INFP": {
        title: "ENFJ と INFP の相性 (魂のパートナー)",
        analysis: "ENFJの『人々を導き、助けたい』という情熱と、INFPの『内なる理想と価値観を大切にしたい』という思いは、見事に共鳴します。ENFJはINFPの持つ素晴らしいアイデアや深い感情を社会に繋げる架け橋となり、INFPはENFJに内省と真の思いやりの視点を与えます。お互いが持つ長所を最大限に引き出し、短所を補い合いながら共に成長できる、最高の関係の一つです。",
        conversation: `ENFJ: 「君がこの前話してくれた『誰もが安心して自分のことを話せる場所を作りたい』って夢、本当に感動したんだ。それで少し考えてみたんだけど、まずは小さなオンラインコミュニティから始めてみない？僕が人集めや運営を手伝うよ。君のその温かい心は、絶対にたくさんの人を救う力になるから！」\n\nINFP: 「え…本当？そんなこと言ってくれるなんて…。一人で心の中で思ってるだけだったから、誰かにそう言ってもらえてすごく嬉しい。でも、私にそんなことができるかな…。」\n\nENFJ: 「できるに決まってるさ！君は一人じゃない。僕が隣で全力で応援する。さあ、一緒に世界を少しだけ優しくする冒険を始めよう！」`
    },
    "ESFP-INFP": {
        title: "ESFP と INFP の相性 (互いの世界を広げる関係)",
        analysis: "『今を楽しむ現実主義者』のESFPと、『未来を夢見る理想主義者』のINFP。一見正反対に見えますが、どちらも感情(F)を大切にし、柔軟(P)であるという共通点があります。ESFPはINFPを外の世界に連れ出し、現実の楽しさを教えます。一方、INFPはESFPに物事の裏にある意味や可能性を伝え、内面的な豊かさを与えます。お互いの視点の違いを尊重し、好奇心を持って学び合えれば、これ以上ないほど互いの世界を広げることができる、刺激的で成長に満ちた関係です。",
        conversation: `ESFP: 「見て見て、この夕日すっごくキレイじゃない！？今すぐ写真撮ってストーリーにあげなきゃ！あ、この後、新しくできたバーに行ってみない？音楽がいい感じらしいよ！」\n\nINFP: 「本当だ、きれいだね…。空の色がゆっくりと混ざり合っていくのを見てると、なんだか壮大な物語の始まりみたいで、いろんな想像が膨らむな…。バーもいいけど、もう少しだけ、この静かな時間を味わっていたいかも。」\n\nESFP: 「そっか！じゃあ、この夕日が完全に沈むまで一緒にいよう！その『壮大な物語』ってやつ、聞かせてよ！それからバーに行っても遅くないもんね！」`
    }
    // ... 他の組み合わせもこの形式で追加してください ...
};

// 2. DOM要素の取得
// =================================
const inputEl = document.getElementById('mbti-input');
const analyzeBtn = document.getElementById('analyze-button');
const resultArea = document.getElementById('result-area');

// 3. イベントリスナーの設定
// =================================
analyzeBtn.addEventListener('click', analyzeMbti);
inputEl.addEventListener('keyup', (event) => {
    if (event.key === 'Enter') {
        analyzeMbti();
    }
});

// 4. 分析ロジックの関数
// =================================
function analyzeMbti() {
    const inputText = inputEl.value.trim().toUpperCase();
    if (!inputText) {
        resultArea.innerHTML = `<p class="result-card">分析したいMBTIタイプを入力してください。</p>`;
        return;
    }

    const types = inputText.split(/[\s,]+/).filter(type => type !== "");

    if (types.length === 1) {
        displaySingleTypeResult(types[0]);
    } else if (types.length === 2) {
        displayCompatibilityResult(types[0], types[1]);
    } else {
        resultArea.innerHTML = `<p class="result-card">エラー: 1つまたは2つのMBTIタイプを正しく入力してください。</p>`;
    }
}

// 5. 結果表示用の関数（ここが抜けていました）
// =================================

// 単独タイプの結果を表示
function displaySingleTypeResult(type) {
    const data = mbtiData[type];
    if (data) {
        let html = `
            <div class="result-card">
                <h2>${data.title} - "${data.alias}"</h2>
                <p class="description">${data.description}</p>
                
                <h3>より詳しい特徴</h3>
                <p>${data.detailed_description}</p>
                
                <div class="strengths-weaknesses">
                    <div class="strengths">
                        <h4><i class="fas fa-check-circle"></i> 強み</h4>
                        <ul>
                            ${data.strengths.map(char => `<li>${char}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="weaknesses">
                        <h4><i class="fas fa-exclamation-circle"></i> 弱み</h4>
                        <ul>
                            ${data.weaknesses.map(char => `<li>${char}</li>`).join('')}
                        </ul>
                    </div>
                </div>

                <h3>日常会話の事例</h3>
                <div class="conversation-box">
                    <p>${data.conversation.replace(/\n/g, '<br>')}</p>
                </div>
            </div>
        `;
        resultArea.innerHTML = html;
    } else {
        resultArea.innerHTML = `<p class="result-card">エラー: 「${type}」というMBTIタイプが見つかりませんでした。データが追加されるまでお待ちください。</p>`;
    }
}

// 2タイプの相性結果を表示
function displayCompatibilityResult(type1, type2) {
    const key = [type1, type2].sort().join('-');
    const data = compatibilityData[key];

    if (mbtiData[type1] && mbtiData[type2] && data) {
        let html = `
            <div class="result-card">
                <h2>${data.title}</h2>
                <h3>相性分析:</h3>
                <p>${data.analysis}</p>
                <h3>二人の日常会話:</h3>
                <div class="conversation-box">
                    <p>${data.conversation.replace(/\n/g, '<br>')}</p>
                </div>
            </div>
        `;
        resultArea.innerHTML = html;
    } else {
        resultArea.innerHTML = `<p class="result-card">エラー: 「${type1}」と「${type2}」の組み合わせの相性データは見つかりませんでした。データが追加されるまでお待ちください。</p>`;
    }
}